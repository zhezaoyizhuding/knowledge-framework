#### 系统架构

<img src="https://yusheng-picgo.oss-cn-beijing.aliyuncs.com/picgo/image-20211214173139164.png" alt="image-20211214173139164" style="zoom:50%;" />

#### 项目介绍

该项目是当初公司的统一权限管理项目，目的是对后台运营系统进行权限控制。该系统将权限定义为一个个资源点，最细可以做到接口层面的权限控制。整个系统领域划分为用户、角色、功能、菜单、资源等，功能是资源的集合，菜单和功能平级，角色是功能的集合，用户是角色的集合。但是各个表之间的关系都是多对多的，因此可以灵活配置用户的权限。

#### 亮点

###### 1、领域设计清晰

- 领域划分清晰，整体结构合理
- 客户端接入方便，使用注解进行权限控制，低代码侵入
- 自有运营后台，权限配置方便

#### 痛点

###### 1、权限位录入麻烦

描述：虽然由于对功能和角色的复用，使得给用户分配权限比较方便。但是在新系统接入时的资源位录入比较麻烦，需要一个接口一个接口录入。当时多位接入方反馈。

解决：在客户端中增加新的注解，可以再系统首次接入时进行资源位上报，直接把接口资源录入到权限系统中

#### 后续优化

###### 1、引入二进制优化权限授予流程

描述：该系统在设计之初是用关系表来表示各个实体之间的拥有关系，由于是多对多的关系，所以关系表的大小会比实体表大得多。比如如果用户表的数量是10万，功能表是1000，那么最坏的情况下，关系表将拥有1亿条记录。因此可以考虑采用二进制来降低关系表的膨胀。

解决：在用户表、功能表分别引入两个long型字段，一个表示功能组，递增；一个表示功能位，64位每位表示一个功能。因此一个功能组可以拥有64个功能位（该优化也可用在资源位上）。那么当一个用户拥有三个功能组的权限时，关系表里只需要三条记录；没引入二进制之前最坏得有3*64条记录。

用户表与功能表的功能位字段做二进制操作：

或：增加功能

与：判断是否拥有该功能

取反再与：删除该功能