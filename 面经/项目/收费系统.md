## 系统架构

![image-20230405174651208](https://yusheng-picgo.oss-cn-beijing.aliyuncs.com/picgo/image-20230405174651208.png)

### 账单实时结算与T+1结算主流程

![业务主流程](https://yusheng-picgo.oss-cn-beijing.aliyuncs.com/picgo/%E4%B8%9A%E5%8A%A1%E4%B8%BB%E6%B5%81%E7%A8%8B.png)

### 账单逾期处罚流程

![image-20230213115932145](https://yusheng-picgo.oss-cn-beijing.aliyuncs.com/picgo/image-20230213115932145.png)

## 项目介绍

收费系统是一个集收支结算、退款、开票、支付于一体的系统，是政采云数字化重要的一部分。它包含实时计费和T+1计费两种计费方式，实时计费包含保证金、年费、服务费、以及交易抽佣（前置抽佣）等多种费用；T+1模式主要用于交易抽佣中的后置抽佣，由于数据量大、并且是后置模式，因此可以从交易核心流程中抽离，采用走数仓的模式进行T+1账期结算。

包含以下三个系统：

计费系统、开票系统、收支看板

### 亮点

#### 1、多角色、多角度的财务结算系统

千人千面、数据隔离。每个用户登录进去都可以看到自己应收、应付、预算、账户信息、营收分析等，可独立进行运营。自主进行权限配置、退款、支付、开票、优惠等操作。

#### 2、成熟的平台能力、可快速接入，计算各业务线的财务收入

健全完善的SDK，方便业务方进行一站式的财务收支计算。

### 痛点

#### 1、代码臃肿、耦合性严重、复杂性爆炸

该系统服务时间较长，前后经过多代开发人员维护，代码风格各异。需要进行较长时间的去肥重构，构建稳健的代码架构。

#### 2、营收权限控制与业务流程耦合严重

功能权限与数据权限与通用的业务流程耦合较深，很难进行灵活的权限控制。需要进行权限与业务的隔离

#### 3、表结构设计不合理，代码中存在大量的多表join，慢sql治理任重道远

由于前期的表结构设计不合理，系统中存在大量慢SQL，需要花费大量时间治理

#### 4、缺乏成熟的对账系统

缺乏成熟的对账系统，资金的准确性完全由业务人员保证。结算最重要的是准确，但是该系统并没有资金准确性的监控告警

### 后续规划

对账告警、营收看板、账户体系